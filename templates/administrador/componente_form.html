{% extends 'administrador/base_admin.html' %}
{% load static %}

{% block extra_css %}
<style>
/* Modal-like form similar to provided screenshot */
.modal-card{
  max-width:980px;
  margin:32px auto;
  background:#fff;
  border-radius:12px;
  box-shadow:0 12px 40px rgba(2,6,23,0.24);
  overflow:hidden;
}
.modal-header{
  background: linear-gradient(135deg,#1e3a8a 0%,#1e40af 100%);
  color:#fff;
  padding:28px 32px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.modal-header h3{margin:0;font-size:1.6rem}
.modal-body{display:flex;gap:28px;padding:28px;background:#f8fafc}
.left-col{flex:1}
.right-col{width:360px}
.field{margin-bottom:18px}
.field label{display:block;font-size:0.85rem;color:#334155;margin-bottom:8px;font-weight:700}
.field input[type=text], .field select, .field textarea, .field input[type=file]{
  width:100%;padding:12px;border-radius:10px;border:1px solid #e6edf6;background:#fbfdff;font-size:0.95rem;color:#0f172a;box-shadow:none;resize:vertical;
}
.field textarea{min-height:120px}
.preview-box{background:#fff;border-radius:10px;border:1px solid #e6edf6;padding:18px;display:flex;align-items:center;justify-content:center;min-height:200px}
.preview-box img{max-width:100%;max-height:220px;object-fit:contain;border-radius:8px}
.no-image{color:#94a3b8;display:flex;flex-direction:column;align-items:center;gap:8px}
.files-box{margin-top:18px;padding:12px;border-radius:10px;border:1px dashed #e6edf6;background:#fff}
.modal-footer{display:flex;justify-content:flex-end;gap:12px;padding:18px 28px 28px 28px;background:white}
.btn-primary{background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;padding:10px 18px;border-radius:10px;border:0;font-weight:700}
.btn-secondary{background:#eef2ff;color:#0f172a;padding:10px 16px;border-radius:10px;border:0}
.close-btn{background:rgba(255,255,255,0.12);color:#fff;border-radius:8px;padding:8px 10px;border:0}

@media (max-width:900px){
  .modal-body{flex-direction:column}
  .right-col{width:100%}
}
</style>
{% endblock %}

{% block content %}
<div class="modal-card">
  <div class="modal-header">
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-size:1.4rem;display:inline-flex;width:44px;height:44px;border-radius:10px;align-items:center;justify-content:center;background:rgba(255,255,255,0.08)"><i class="fas fa-plus"></i></span>
      <div>
        <h3>Agregar componente</h3>
        <div style="opacity:0.9;font-size:0.95rem">Complete los datos del componente</div>
      </div>
    </div>
    <div>
      <button class="close-btn" onclick="window.history.back();"><i class="fas fa-times"></i></button>
    </div>
  </div>

  <form method="post" enctype="multipart/form-data" style="margin:0">
    {% csrf_token %}
    <div class="modal-body">
      <div class="left-col">
        <div class="field">
          <label for="id_nombre">NOMBRE:</label>
          {{ form.nombre }}
        </div>

        <div class="field">
          <label for="id_laboratorio">LABORATORIO:</label>
          {{ form.laboratorio }}
        </div>

        <div class="field">
          <label for="id_descripcion">DESCRIPCIÃ“N:</label>
          {{ form.descripcion }}
        </div>

        <div class="files-box">
          <label style="font-weight:700;color:#334155">ARCHIVOS</label>
          <div style="margin-top:8px">
            <label for="id_imagen" style="display:block;font-size:17px;color:#475569;margin-bottom:8px;padding: 10px 0px;">Imagen de componente</label>
            {{ form.imagen }}
          </div>
        </div>
      </div>

      <div class="right-col">
        <div style="font-weight:700;color:#334155;margin-bottom:10px">VISTA PREVIA</div>
        <div class="preview-box" id="previewBox">
          <div class="no-image" id="noImageBlock">
            <i class="fas fa-puzzle-piece" style="font-size:34px;color:#cbd5e1"></i>
            <div>No hay imagen</div>
          </div>
          <img id="previewImg" src="" alt="" style="display:none" />
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <a href="{% url 'componentes_list' %}" class="btn-secondary" style="text-decoration: none;background-color: #c4c4c4;">Cancelar</a>
      <button type="submit" class="btn-primary">Guardar componente</button>
    </div>
  </form>
</div>

<script>
// Mostrar vista previa de imagen cuando se selecciona un archivo
document.addEventListener('DOMContentLoaded', function(){
  const fileInput = document.querySelector('input[type=file]#id_imagen');
  const previewImg = document.getElementById('previewImg');
  const noImageBlock = document.getElementById('noImageBlock');

  if (!fileInput) return;

  fileInput.addEventListener('change', function(e){
    const file = e.target.files && e.target.files[0];
    if (!file) {
      previewImg.style.display = 'none';
      noImageBlock.style.display = 'flex';
      previewImg.src = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = function(ev){
      previewImg.src = ev.target.result;
      previewImg.style.display = 'block';
      noImageBlock.style.display = 'none';
    }
    reader.readAsDataURL(file);
  });
});
</script>

</script>

{% endblock %}