{% extends 'superadministrador/base_superadmin.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2 class="titulo-pagina">Gestión de Estudiantes</h2>

    <div class="acciones-superiores">
        <button class="btn btn-primary" id="btn-agregar">
            <i class="fas fa-user-plus"></i> Nuevo Alumno
        </button>
    </div>

    <div class="tabla-container">
        <table class="tabla-estudiantes">
            <thead>
                <tr>
                    <th>Nombre completo</th>
                    <th>Curso</th>
                    <th>Colegio</th>
                    <th>Correo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for estudiante in estudiantes %}
                <tr>
                    <td>{{ estudiante.persona.nombre }} {{ estudiante.persona.apellidoPaterno }} {{ estudiante.persona.apellidoMaterno }}</td>
                    <td>{{ estudiante.curso }}</td>
                    <td>{{ estudiante.colegio.nombre }}</td>
                    <td>{{ estudiante.persona.usuario.correo }}</td>

                    <td class="acciones-cell">
                        <button class="btn btn-tertiary btn-sm btn-editar"
                                data-id="{{ estudiante.id }}"
                                data-nombres="{{ estudiante.persona.nombre }}"
                                data-apellidos="{{ estudiante.persona.apellidoPaterno }} {{ estudiante.persona.apellidoMaterno }}"
                                data-curso="{{ estudiante.curso }}"
                                data-colegio="{{ estudiante.colegio.id }}"
                                data-email="{{ estudiante.persona.usuario.correo }}"
>
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-secondary btn-sm">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align:center;">No hay estudiantes registrados</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- === Modal === -->
<div id="modal-alumno" class="modal">
    <div class="modal-content">
        <h3 id="modal-titulo" class="modal-titulo"><i class="fas fa-user-plus"></i> Nuevo Alumno</h3>

        <form id="form-alumno" method="POST" action="{% url 'gestion_estudiante' %}">
            {% csrf_token %}
            <input type="hidden" id="alumno-id" name="alumno-id">

            <div class="form-group">
                <label for="alumno-nombres">Nombres:</label>
                <input type="text" id="alumno-nombres" name="alumno-nombres" required>
            </div>

            <div class="form-group">
                <label for="alumno-apellidos">Apellidos:</label>
                <input type="text" id="alumno-apellidos" name="alumno-apellidos" required>
            </div>

            <div class="form-group">
                <label for="alumno-curso">Curso:</label>
                <input type="text" id="alumno-curso" name="alumno-curso" required>
            </div>

            <div class="form-group">
                <label for="alumno-colegio">Colegio:</label>
                <select id="alumno-colegio" name="alumno-colegio" required>
                    <option value="">Seleccione un colegio</option>
                    {% for colegio in colegios %}
                        <option value="{{ colegio.id }}">{{ colegio.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="alumno-email">Correo Electrónico:</label>
                <input type="email" id="alumno-email" name="alumno-email" placeholder="correo@ejemplo.com" required>
            </div>

            <div class="form-group">
                <label for="alumno-password">Contraseña:</label>
                <input type="password" id="alumno-password" name="alumno-password" placeholder="Ingrese una contraseña segura">
                <small>Dejar vacío si no desea cambiar la contraseña al editar</small>
            </div>

            <div class="modal-botones">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar</button>
                <button type="button" class="btn btn-secondary" id="btn-cerrar-modal"><i class="fas fa-times"></i> Cancelar</button>
            </div>
        </form>
    </div>
</div>

<style>
.container { max-width: 1000px; margin:auto; padding:20px; }
.titulo-pagina { font-size:1.8em; font-weight:600; margin-bottom:15px; }
.acciones-superiores { display:flex; justify-content:flex-end; margin-bottom:10px; }
.btn { border:none; border-radius:8px; padding:8px 12px; cursor:pointer; }
.btn-primary { background-color:#007bff; color:white; }
.btn-tertiary { background-color:#ffc107; color:black; }
.btn-secondary { background-color:#6c757d; color:white; }
.btn-sm { padding:5px 8px; font-size:0.9em; }
.tabla-container { margin-top:20px; overflow-x:auto; }
.tabla-estudiantes { width:100%; border-collapse:collapse; }
.tabla-estudiantes th, .tabla-estudiantes td { padding:10px; border:1px solid #ddd; }
.tabla-estudiantes th { background-color:#f8f9fa; }
.acciones-cell { display:flex; gap:5px; justify-content:center; }
.modal { display:none; position:fixed; inset:0; background-color:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal.active { display:flex; }
.modal-content { background:white; padding:20px; border-radius:12px; width:400px; }
.modal-titulo { margin-bottom:15px; font-size:1.2em; display:flex; align-items:center; gap:10px; }
.form-group { margin-bottom:10px; display:flex; flex-direction:column; }
.modal-botones { display:flex; justify-content:flex-end; gap:10px; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('modal-alumno');
    const modalTitulo = document.getElementById('modal-titulo');
    const btnAgregar = document.getElementById('btn-agregar');
    const btnCerrarModal = document.getElementById('btn-cerrar-modal');
    const btnEditar = document.querySelectorAll('.btn-editar');
    const formAlumno = document.getElementById('form-alumno');

    btnAgregar.addEventListener('click', () => {
        modalTitulo.innerHTML = '<i class="fas fa-user-plus"></i> Nuevo Alumno';
        formAlumno.reset();
        document.getElementById('alumno-id').value = '';
        modal.classList.add('active');
    });

    btnEditar.forEach(btn => {
        btn.addEventListener('click', function() {
            modalTitulo.innerHTML = '<i class="fas fa-user-edit"></i> Editar Alumno';
            document.getElementById('alumno-id').value = this.dataset.id;
            document.getElementById('alumno-nombres').value = this.dataset.nombres;
            document.getElementById('alumno-apellidos').value = this.dataset.apellidos;
            document.getElementById('alumno-curso').value = this.dataset.curso;
            document.getElementById('alumno-colegio').value = this.dataset.colegio;
            document.getElementById('alumno-email').value = this.dataset.email;
            document.getElementById('alumno-password').value = '';
            modal.classList.add('active');
        });
    });

    btnCerrarModal.addEventListener('click', () => modal.classList.remove('active'));
});
</script>
{% endblock %}
