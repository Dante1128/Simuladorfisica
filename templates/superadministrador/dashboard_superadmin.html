{% extends 'superadministrador/base_superadmin.html' %}
{% load static %}
{% block title %}Informes y Reportes - Superadministrador{% endblock %}

{% block extra_css %}
<style>
/* RESET COMPLETO Y CORRECCIÓN DEL NAVBAR - VERSIÓN MEJORADA */
.dashboard-superadmin-page {
    margin: 0 !important;
    padding: 0 !important;
    position: relative;
    width: 100% !important;
    min-height: 100vh;
}

/* Ocultar completamente el sidebar del template base */
.dashboard-superadmin-page .sidebar {
    display: none !important;
}

/* Reset completo del main-content */
.dashboard-superadmin-page .main-content {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    min-height: 100vh;
    position: relative;
    left: 0 !important;
    top: 0 !important;
}

/* Asegurar que no hay desplazamiento */
.dashboard-superadmin-page body {
    overflow-x: hidden !important;
}

/* Contenedor principal del dashboard */
.dashboard-superadmin-container {
    width: 100%;
    min-height: 100vh;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}
</style>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="dashboard-superadmin-page">
    <div class="dashboard-superadmin-container">
        <!-- Header Principal -->
        <header class="dashboard-header">
            <div class="header-container">
                <div class="header-content">
                    <div class="header-title-section">
                        <div class="title-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="title-text">
                            <h1>Informes y Reportes</h1>
                            <p class="subtitle">Vista completa del sistema educativo</p>
                        </div>
                    </div>
                    
                    <div class="header-controls">
                        <div class="user-badge">
                            <div class="user-avatar-mini">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="user-details">
                                <span class="user-role">SUPERADMINISTRADOR</span>
                                <span class="user-access">Acceso total al sistema</span>
                            </div>
                        </div>
                        
                        <a href="{% url 'panel_superadmin' %}" class="back-to-panel-btn">
                            <i class="fas fa-arrow-left"></i>
                            <span>Volver al Panel</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Contenido Principal -->
        <main class="dashboard-main-content">
            <div class="content-container">
                
                <!-- Sección de Herramientas Principales -->
                <section class="tools-main-section">
                    <!-- Filtros -->
                    <div class="filters-card">
                        <div class="card-header">
                            <h2>
                                <i class="fas fa-filter"></i>
                                Filtros de Búsqueda
                            </h2>
                        </div>
                        <div class="card-body">
                            <form method="GET" class="filters-form">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label for="fecha" class="form-label">
                                            <i class="fas fa-calendar"></i>
                                            Fecha
                                        </label>
                                        <input type="date" id="fecha" name="fecha" value="{{ fecha_filtro }}" class="form-control">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="colegio" class="form-label">
                                            <i class="fas fa-school"></i>
                                            Colegio
                                        </label>
                                        <select id="colegio" name="colegio" class="form-control">
                                            <option value="">Todos los colegios</option>
                                            {% for colegio in colegios %}
                                            <option value="{{ colegio.id }}" {% if filtro_colegio == colegio.id|stringformat:"s" %}selected{% endif %}>
                                                {{ colegio.nombre }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-filter">
                                            <i class="fas fa-search"></i>
                                            Aplicar Filtros
                                        </button>
                                        <a href="{% url 'dashboard_superadmin' %}" class="btn btn-clear">
                                            <i class="fas fa-broom"></i>
                                            Limpiar
                                        </a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Descarga PDF -->
                    <div class="download-card">
                        <div class="download-content">
                            <div class="download-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="download-info">
                                <h3>Informe Completo PDF</h3>
                                <p>Descarga un reporte detallado con todas las estadísticas del sistema</p>
                            </div>
                            <a href="{% url 'generar_reporte_completo_pdf' %}" class="download-btn">
                                <i class="fas fa-download"></i>
                                Descargar
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Estadísticas Principales -->
                <section class="stats-section">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-chart-bar"></i>
                            Resumen General del Sistema
                        </h2>
                        <p class="section-description">Métricas clave en tiempo real</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item stat-primary">
                            <div class="stat-icon-wrapper">
                                <i class="fas fa-school"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ estadisticas.total_colegios|default:"0" }}</div>
                                <div class="stat-label">Total Colegios</div>
                            </div>
                        </div>

                        <div class="stat-item stat-success">
                            <div class="stat-icon-wrapper">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ estadisticas.total_usuarios|default:"0" }}</div>
                                <div class="stat-label">Total Usuarios</div>
                            </div>
                        </div>

                        <div class="stat-item stat-info">
                            <div class="stat-icon-wrapper">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ estadisticas.total_estudiantes|default:"0" }}</div>
                                <div class="stat-label">Total Estudiantes</div>
                            </div>
                        </div>

                        <div class="stat-item stat-warning">
                            <div class="stat-icon-wrapper">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ estadisticas.total_profesores|default:"0" }}</div>
                                <div class="stat-label">Total Profesores</div>
                            </div>
                        </div>

                        <div class="stat-item stat-purple">
                            <div class="stat-icon-wrapper">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ estadisticas.total_suscripciones|default:"0" }}</div>
                                <div class="stat-label">Suscripciones Activas</div>
                            </div>
                        </div>

                        <div class="stat-item stat-gold">
                            <div class="stat-icon-wrapper">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">${{ estadisticas.ingresos_totales|floatformat:2|default:"0.00" }}</div>
                                <div class="stat-label">Ingresos Totales</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Gráficos y Visualizaciones -->
                <section class="charts-section">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-chart-pie"></i>
                            Visualizaciones de Datos
                        </h2>
                        <p class="section-description">Análisis gráfico de la información</p>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>
                                    <i class="fas fa-chart-pie"></i>
                                    Distribución de Usuarios
                                </h3>
                                <span class="chart-subtitle">Por tipo de rol en el sistema</span>
                            </div>
                            <div class="chart-container">
                                <div id="chartTortaRoles" class="chart-render-area"></div>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>
                                    <i class="fas fa-chart-bar"></i>
                                    Top Colegios
                                </h3>
                                <span class="chart-subtitle">Con mayor número de estudiantes</span>
                            </div>
                            <div class="chart-container">
                                <div id="chartBarrasColegios" class="chart-render-area"></div>
                            </div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>
                                    <i class="fas fa-chart-line"></i>
                                    Suscripciones
                                </h3>
                                <span class="chart-subtitle">Por tipo de membresía</span>
                            </div>
                            <div class="chart-container">
                                <div id="chartBarrasMembresias" class="chart-render-area"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tablas de Datos -->
                <section class="tables-section">
                    <div class="section-header">
                        <h2>
                            <i class="fas fa-table"></i>
                            Datos Detallados
                        </h2>
                        <p class="section-description">Información específica y transacciones</p>
                    </div>
                    
                    <div class="tables-grid">
                        <div class="table-card">
                            <div class="table-header">
                                <h3>
                                    <i class="fas fa-file-contract"></i>
                                    Suscripciones Recientes
                                </h3>
                                <div class="table-actions">
                                    <span class="badge badge-info">{{ suscripciones_recientes.count }} registros</span>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Colegio</th>
                                            <th>Membresía</th>
                                            <th>Fecha Inicio</th>
                                            <th>Fecha Fin</th>
                                            <th>Usuarios</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for suscripcion in suscripciones_recientes %}
                                        <tr>
                                            <td>
                                                <div class="table-cell-with-icon">
                                                    <i class="fas fa-school"></i>
                                                    <span class="cell-text">{{ suscripcion.colegio.nombre|truncatechars:25 }}</span>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge badge-membresia">{{ suscripcion.membresia.nombre }}</span>
                                            </td>
                                            <td>{{ suscripcion.fecha_inicio|date:"d/m/Y" }}</td>
                                            <td>
                                                <span class="date-cell {% if suscripcion.esta_activa %}date-active{% else %}date-expired{% endif %}">
                                                    {{ suscripcion.fecha_fin|date:"d/m/Y" }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="user-count">{{ suscripcion.usuarios_actuales }}</span>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="5" class="no-data">
                                                <i class="fas fa-inbox"></i>
                                                No hay suscripciones recientes
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="table-card">
                            <div class="table-header">
                                <h3>
                                    <i class="fas fa-credit-card"></i>
                                    Pagos Recientes
                                </h3>
                                <div class="table-actions">
                                    <span class="badge badge-success">{{ pagos_recientes.count }} transacciones</span>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Usuario</th>
                                            <th>Monto</th>
                                            <th>Fecha</th>
                                            <th>Método</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for pago in pagos_recientes %}
                                        <tr>
                                            <td>
                                                <div class="table-cell-with-icon">
                                                    <i class="fas fa-user"></i>
                                                    <span class="cell-text">{{ pago.usuario.correo|truncatechars:30 }}</span>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="amount-cell">${{ pago.monto|floatformat:2 }}</span>
                                            </td>
                                            <td>{{ pago.fecha|date:"d/m/Y H:i" }}</td>
                                            <td>
                                                <span class="badge badge-payment">{{ pago.metodo|default:"N/A" }}</span>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="4" class="no-data">
                                                <i class="fas fa-inbox"></i>
                                                No hay pagos recientes
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
</div>

<!-- Highcharts -->
<script src="https://code.highcharts.com/highcharts.js"></script>

<script>
(function() {
    'use strict';
    
    // Función para parsear datos JSON de forma segura
    function safeParseJSON(data, defaultValue) {
        try {
            if (!data || data === 'None' || data === 'null' || data === '') {
                return defaultValue;
            }
            if (typeof data === 'string') {
                return JSON.parse(data);
            }
            return data;
        } catch (error) {
            console.warn('Error parsing JSON:', error);
            return defaultValue;
        }
    }

    // Esperar a que el DOM esté completamente cargado
    document.addEventListener('DOMContentLoaded', function() {
        
        // =====================================================
        // DATOS PARA GRAFICOS
        // =====================================================
        
        // Gráfico de Torta - Distribución de Usuarios por Rol
        const datosTortaRoles = safeParseJSON(
            "{{ datos_torta_roles|escapejs }}",
            [{ name: 'Sin datos', y: 1 }]
        );
        
        // Gráfico de Barras - Colegios con Más Estudiantes
        const datosBarrasColegios = safeParseJSON(
            "{{ datos_barras_colegios|escapejs }}",
            { colegios: ['Sin datos'], estudiantes: [0] }
        );
        
        // Gráfico de Barras - Suscripciones por Membresía
        const datosBarrasMembresias = safeParseJSON(
            "{{ datos_barras_membresias|escapejs }}",
            { membresias: ['Sin datos'], suscripciones: [0] }
        );

        // =====================================================
        // VALIDACION DE DATOS
        // =====================================================
        
        // Validar datos de torta
        const datosTortaValidos = Array.isArray(datosTortaRoles) && datosTortaRoles.length > 0
            ? datosTortaRoles
            : [{ name: 'Sin datos', y: 1, color: '#e0e0e0' }];

        // Validar datos de barras colegios
        const datosColegiosValidos = 
            datosBarrasColegios && 
            Array.isArray(datosBarrasColegios.colegios) && 
            datosBarrasColegios.colegios.length > 0
                ? datosBarrasColegios
                : { colegios: ['Sin datos'], estudiantes: [0] };

        // Validar datos de barras membresias
        const datosMembresiasValidos = 
            datosBarrasMembresias && 
            Array.isArray(datosBarrasMembresias.membresias) && 
            datosBarrasMembresias.membresias.length > 0
                ? datosBarrasMembresias
                : { membresias: ['Sin datos'], suscripciones: [0] };

        // =====================================================
        // CONFIGURACION GLOBAL DE HIGHCHARTS
        // =====================================================
        
        Highcharts.setOptions({
            lang: {
                thousandsSep: ',',
                decimalPoint: '.',
                noData: 'No hay datos disponibles'
            },
            credits: {
                enabled: false
            },
            chart: {
                style: {
                    fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif'
                }
            }
        });

        // =====================================================
        // GRAFICO 1: TORTA - DISTRIBUCION DE USUARIOS
        // =====================================================
        
        if (document.getElementById('chartTortaRoles')) {
            try {
                Highcharts.chart('chartTortaRoles', {
                    chart: {
                        type: 'pie',
                        backgroundColor: 'transparent',
                        height: 320,
                        spacing: [20, 20, 20, 20]
                    },
                    title: {
                        text: null
                    },
                    tooltip: {
                        pointFormat: '<b>{point.y}</b> usuarios ({point.percentage:.1f}%)',
                        style: {
                            fontSize: '13px'
                        }
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: true,
                                format: '<b>{point.name}</b><br>{point.y}',
                                style: {
                                    fontSize: '12px',
                                    textOutline: 'none',
                                    fontWeight: '500'
                                },
                                distance: 20
                            },
                            showInLegend: false,
                            colors: ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c', '#34495e']
                        }
                    },
                    series: [{
                        name: 'Usuarios',
                        colorByPoint: true,
                        data: datosTortaValidos
                    }]
                });
            } catch (error) {
                console.error('Error al crear grafico de torta:', error);
                document.getElementById('chartTortaRoles').innerHTML = 
                    '<div class="chart-error">Error al cargar el gráfico</div>';
            }
        }

        // =====================================================
        // GRAFICO 2: BARRAS - COLEGIOS CON MAS ESTUDIANTES
        // =====================================================
        
        if (document.getElementById('chartBarrasColegios')) {
            try {
                Highcharts.chart('chartBarrasColegios', {
                    chart: {
                        type: 'column',
                        backgroundColor: 'transparent',
                        height: 320
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        categories: datosColegiosValidos.colegios,
                        title: {
                            text: null
                        },
                        labels: {
                            style: {
                                fontSize: '11px'
                            },
                            rotation: -45
                        }
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: 'Número de Estudiantes',
                            style: {
                                fontSize: '12px',
                                fontWeight: '500'
                            }
                        },
                        labels: {
                            style: {
                                fontSize: '11px'
                            }
                        }
                    },
                    tooltip: {
                        valueSuffix: ' estudiantes',
                        style: {
                            fontSize: '12px'
                        }
                    },
                    plotOptions: {
                        column: {
                            borderRadius: 4,
                            dataLabels: {
                                enabled: true,
                                style: {
                                    fontSize: '11px',
                                    fontWeight: 'bold',
                                    textOutline: 'none'
                                }
                            }
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    series: [{
                        name: 'Estudiantes',
                        data: datosColegiosValidos.estudiantes,
                        color: '#3498db'
                    }]
                });
            } catch (error) {
                console.error('Error al crear grafico de colegios:', error);
                document.getElementById('chartBarrasColegios').innerHTML = 
                    '<div class="chart-error">Error al cargar el gráfico</div>';
            }
        }

        // =====================================================
        // GRAFICO 3: BARRAS - SUSCRIPCIONES POR MEMBRESIA
        // =====================================================
        
        if (document.getElementById('chartBarrasMembresias')) {
            try {
                Highcharts.chart('chartBarrasMembresias', {
                    chart: {
                        type: 'column',
                        backgroundColor: 'transparent',
                        height: 320
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        categories: datosMembresiasValidos.membresias,
                        title: {
                            text: null
                        },
                        labels: {
                            style: {
                                fontSize: '12px'
                            }
                        }
                    },
                    yAxis: {
                        min: 0,
                        title: {
                            text: 'Suscripciones',
                            style: {
                                fontSize: '12px',
                                fontWeight: '500'
                            }
                        },
                        labels: {
                            style: {
                                fontSize: '11px'
                            }
                        },
                        allowDecimals: false
                    },
                    tooltip: {
                        valueSuffix: ' suscripciones',
                        style: {
                            fontSize: '12px'
                        }
                    },
                    plotOptions: {
                        column: {
                            borderRadius: 4,
                            dataLabels: {
                                enabled: true,
                                style: {
                                    fontSize: '11px',
                                    fontWeight: 'bold',
                                    textOutline: 'none'
                                }
                            }
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    series: [{
                        name: 'Suscripciones',
                        data: datosMembresiasValidos.suscripciones,
                        color: '#27ae60'
                    }]
                });
            } catch (error) {
                console.error('Error al crear grafico de membresias:', error);
                document.getElementById('chartBarrasMembresias').innerHTML = 
                    '<div class="chart-error">Error al cargar el gráfico</div>';
            }
        }

        console.log('Dashboard de Superadministrador - Distribución corregida cargada correctamente');
    });
})();
</script>

<style>
/* VARIABLES CSS MEJORADAS */
:root {
    --primary-blue: #133E87;
    --secondary-blue: #608BC1;
    --light-blue: #CBDCEB;
    --success-green: #27ae60;
    --warning-orange: #f39c12;
    --danger-red: #e74c3c;
    --info-cyan: #3498db;
    --dark-gray: #2c3e50;
    --light-gray: #f8f9fa;
    --medium-gray: #e9ecef;
    --border-gray: #dee2e6;
    --white: #ffffff;
    --text-dark: #2d3748;
    --text-medium: #4a5568;
    --text-light: #718096;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* RESET COMPLETO Y SEGURO */
.dashboard-superadmin-container {
    min-height: 100vh;
    background: linear-gradient(135deg, var(--light-gray) 0%, var(--white) 100%);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    color: var(--text-dark);
    line-height: 1.6;
}

.dashboard-superadmin-container * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* HEADER MEJORADO */
.dashboard-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, #0a2952 100%);
    color: var(--white);
    padding: 1.5rem 0;
    box-shadow: var(--shadow-lg);
    position: relative;
    z-index: 100;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.header-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
}

.header-title-section {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.title-icon {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    backdrop-filter: blur(10px);
}

.title-text h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    color: var(--white);
}

.title-text .subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    color: var(--light-blue);
}

.header-controls {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.user-badge {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
    backdrop-filter: blur(10px);
}

.user-avatar-mini {
    width: 35px;
    height: 35px;
    background: var(--light-blue);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-blue);
    font-size: 1rem;
}

.user-details {
    display: flex;
    flex-direction: column;
}

.user-role {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--white);
}

.user-access {
    font-size: 0.7rem;
    opacity: 0.8;
    color: var(--light-blue);
}

.back-to-panel-btn {
    background: rgba(255, 255, 255, 0.15);
    color: var(--white);
    padding: 0.6rem 1.2rem;
    border-radius: var(--radius-sm);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition);
    font-size: 0.85rem;
    font-weight: 500;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.back-to-panel-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* CONTENIDO PRINCIPAL */
.dashboard-main-content {
    padding: 2rem 0;
}

.content-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
}

/* SECCIONES GENERALES */
.section-header {
    margin-bottom: 1.5rem;
}

.section-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
}

.section-description {
    color: var(--text-light);
    font-size: 0.9rem;
}

/* HERRAMIENTAS PRINCIPALES */
.tools-main-section {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-bottom: 2.5rem;
}

.filters-card,
.download-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    overflow: hidden;
}

.card-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-gray);
    background: var(--light-gray);
}

.card-header h2 {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-body {
    padding: 1.5rem;
}

/* FORMULARIO DE FILTROS */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 1.5rem;
    align-items: end;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-control {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-gray);
    border-radius: var(--radius-sm);
    font-size: 0.9rem;
    transition: var(--transition);
    width: 100%;
    background: var(--white);
}

.form-control:focus {
    outline: none;
    border-color: var(--secondary-blue);
    box-shadow: 0 0 0 3px rgba(96, 139, 193, 0.1);
}

.form-actions {
    display: flex;
    gap: 0.75rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--radius-sm);
    font-weight: 500;
    font-size: 0.85rem;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition);
    white-space: nowrap;
}

.btn-filter {
    background: var(--secondary-blue);
    color: var(--white);
}

.btn-filter:hover {
    background: var(--primary-blue);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.btn-clear {
    background: var(--medium-gray);
    color: var(--text-medium);
}

.btn-clear:hover {
    background: var(--border-gray);
    color: var(--text-dark);
}

/* TARJETA DE DESCARGA */
.download-content {
    padding: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    height: 100%;
}

.download-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--danger-red) 0%, #c0392b 100%);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--white);
    flex-shrink: 0;
}

.download-info {
    flex: 1;
}

.download-info h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.download-info p {
    font-size: 0.8rem;
    color: var(--text-light);
    line-height: 1.4;
}

.download-btn {
    background: var(--danger-red);
    color: var(--white);
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-sm);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    font-weight: 500;
    transition: var(--transition);
    flex-shrink: 0;
}

.download-btn:hover {
    background: #c0392b;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

/* ESTADÍSTICAS */
.stats-section {
    margin-bottom: 2.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
}

.stat-item {
    background: var(--white);
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: var(--transition);
    border-left: 4px solid;
    position: relative;
    overflow: hidden;
}

.stat-item:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: inherit;
    opacity: 0.1;
}

.stat-primary { border-left-color: var(--info-cyan); }
.stat-success { border-left-color: var(--success-green); }
.stat-info { border-left-color: var(--primary-blue); }
.stat-warning { border-left-color: var(--warning-orange); }
.stat-purple { border-left-color: #9b59b6; }
.stat-gold { border-left-color: #f1c40f; }

.stat-icon-wrapper {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.stat-primary .stat-icon-wrapper { background: rgba(52, 152, 219, 0.1); color: var(--info-cyan); }
.stat-success .stat-icon-wrapper { background: rgba(39, 174, 96, 0.1); color: var(--success-green); }
.stat-info .stat-icon-wrapper { background: rgba(19, 62, 135, 0.1); color: var(--primary-blue); }
.stat-warning .stat-icon-wrapper { background: rgba(243, 156, 18, 0.1); color: var(--warning-orange); }
.stat-purple .stat-icon-wrapper { background: rgba(155, 89, 182, 0.1); color: #9b59b6; }
.stat-gold .stat-icon-wrapper { background: rgba(241, 196, 15, 0.1); color: #f1c40f; }

.stat-content {
    flex: 1;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
    line-height: 1;
}

.stat-label {
    font-size: 0.85rem;
    color: var(--text-light);
    font-weight: 500;
}

/* GRÁFICOS */
.charts-section {
    margin-bottom: 2.5rem;
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
}

.chart-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    transition: var(--transition);
}

.chart-card:hover {
    box-shadow: var(--shadow-lg);
}

.chart-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-gray);
    background: var(--light-gray);
}

.chart-header h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.25rem;
}

.chart-subtitle {
    font-size: 0.8rem;
    color: var(--text-light);
}

.chart-container {
    padding: 1.5rem;
    height: 350px;
}

.chart-render-area {
    width: 100%;
    height: 100%;
}

.chart-error {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--danger-red);
    font-size: 0.9rem;
    font-weight: 500;
}

/* TABLAS */
.tables-section {
    margin-bottom: 2rem;
}

.tables-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 1.5rem;
}

.table-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    overflow: hidden;
}

.table-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-gray);
    background: var(--light-gray);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.table-header h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.table-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.table-container {
    padding: 1.5rem;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
}

.data-table th {
    background: var(--light-gray);
    color: var(--text-dark);
    text-align: left;
    padding: 0.75rem 1rem;
    font-weight: 600;
    white-space: nowrap;
    border-bottom: 1px solid var(--border-gray);
}

.data-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-gray);
}

.data-table tr:hover {
    background: rgba(203, 220, 235, 0.1);
}

.table-cell-with-icon {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.cell-text {
    flex: 1;
    min-width: 0;
}

.no-data {
    text-align: center;
    color: var(--text-light);
    padding: 2rem !important;
    font-style: italic;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

/* BADGES */
.badge {
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    white-space: nowrap;
}

.badge-info {
    background: rgba(52, 152, 219, 0.1);
    color: var(--info-cyan);
}

.badge-success {
    background: rgba(39, 174, 96, 0.1);
    color: var(--success-green);
}

.badge-membresia {
    background: rgba(155, 89, 182, 0.1);
    color: #9b59b6;
}

.badge-payment {
    background: rgba(52, 152, 219, 0.1);
    color: var(--info-cyan);
}

/* ESTILOS ESPECÍFICOS DE CELDAS */
.date-cell {
    font-weight: 500;
}

.date-active {
    color: var(--success-green);
}

.date-expired {
    color: var(--danger-red);
}

.user-count {
    font-weight: 600;
    color: var(--primary-blue);
}

.amount-cell {
    font-weight: 600;
    color: var(--success-green);
}

/* RESPONSIVE */
@media (max-width: 1200px) {
    .tools-main-section {
        grid-template-columns: 1fr;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        justify-content: stretch;
    }
    
    .btn {
        flex: 1;
        justify-content: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .tables-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .content-container {
        padding: 0 1rem;
    }
    
    .header-container {
        padding: 0 1rem;
    }
    
    .header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .header-title-section {
        justify-content: center;
    }
    
    .header-controls {
        width: 100%;
        justify-content: center;
    }
    
    .title-text h1 {
        font-size: 1.5rem;
    }
    
    .download-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .stat-item {
        padding: 1.25rem;
    }
    
    .stat-icon-wrapper {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
    
    .stat-value {
        font-size: 1.75rem;
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .chart-container {
        height: 300px;
        padding: 1rem;
    }
    
    .table-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }
    
    .table-container {
        padding: 1rem;
    }
    
    .data-table {
        font-size: 0.8rem;
    }
    
    .data-table th,
    .data-table td {
        padding: 0.5rem 0.75rem;
    }
}

@media (max-width: 480px) {
    .dashboard-header {
        padding: 1rem 0;
    }
    
    .title-icon {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
    }
    
    .title-text h1 {
        font-size: 1.25rem;
    }
    
    .user-badge {
        padding: 0.4rem 0.8rem;
    }
    
    .user-avatar-mini {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
    }
    
    .back-to-panel-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
    }
    
    .section-header h2 {
        font-size: 1.25rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .form-grid {
        gap: 1rem;
    }
    
    .btn {
        padding: 0.6rem 1.2rem;
        font-size: 0.8rem;
    }
    
    .download-icon {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
    
    .download-info h3 {
        font-size: 1rem;
    }
    
    .chart-container {
        height: 250px;
    }
    
    .table-responsive {
        overflow-x: auto;
    }
    
    .data-table {
        min-width: 600px;
    }
}
</style>
{% endblock %}